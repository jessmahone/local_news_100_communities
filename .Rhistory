source_list <- read_xlsx('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Outlet Concentration Analylsis_Qun/Community_Source List.xlsx', sheet = 'DeDuped')
outlets %>%
View(source_list)
colnames(source_list) <- c("community_id", "city", "source_id", "outlet_name", "outlet_type", "commercial", "located", "url", "notes1", "notes2")
source_list %>%
select(city, outlet_name, url)
source_list <- source_list %>%
select(city, outlet_name, url)
source_list %>%
count(is.na(url))
source_list %>%
distinct(outlet_name, url)
source_list <- source_list %>%
distinct(outlet_name, url)
outlets %>%
left_join(source_list, by = c("city", "url"))
outlets %>%
left_join(source_list, by = "url")
outlets
source_list %>%
distinct_url
source_list %>%
distinct(url)
source_list %>%
distinct(url, .keep_all = TRUE)
source_list <- source_list %>%
distinct(url, .keep_all = TRUE)
outlets %>%
left_join(source_list, by = "url")
outlets <- outlets %>%
left_join(source_list, by = "url")
outlets %>%
select(outlet_id, outlet_name, everything())
outlets <- outlets %>%
select(outlet_id, outlet_name, everything())
View(source_list)
source_list <- read_xlsx('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Outlet Concentration Analylsis_Qun/Community_Source List.xlsx', sheet = 'DeDuped')
View(source_list)
colanmes("community_id", "city", "outlet_id", "outlet_name", "outlet_type", "commercial", "located", "url", "notes1", "notes2")
colanmes(source_list) <- c("community_id", "city", "outlet_id", "outlet_name", "outlet_type", "commercial", "located", "url", "notes1", "notes2")
colnames(source_list) <- c("community_id", "city", "outlet_id", "outlet_name", "outlet_type", "commercial", "located", "url", "notes1", "notes2")
source_list %>%
select(city, outlet_id, outlet_name, url)
source_list %>%
select(outlet_name, url, city)
source_list <- source_list %>%
select(outlet_name, url, city)
source_list %>%
distinct(url, .keep_all = TRUE)
source_list <- source_list %>%
distinct(url, .keep_all = TRUE)
source_list %>%
right_join(outlets, by = "url")
source_list %>%
right_join(outlets, by = c("outlet_name", "city", "url")
source_list %>%
right_join(outlets, by = c("outlet_name", "city", "url"))
source_list %>%
right_join(outlets, by = c("outlet_name", "city", "url")) %>%
select(outlet_id, everything())
source_list <- source_list %>%
right_join(outlets, by = c("outlet_name", "city", "url")) %>%
select(outlet_id, everything())
colnames(stories) <- c("story_id", "coder_id", "community_id", "outlet_id", "day", "headline", "original", "local", "cin", "notes", "problems", "notes2", "notes3", "notes4", "notes5")
stories %>%
select(-c(notes, problems, notes2, notes3, notes4, notes5))
stories <- stories %>%
select(-c(notes, problems, notes2, notes3, notes4, notes5))
stories %>%
select(-c(coder_id, day))
stories <- stories %>%
select(-c(coder_id, day))
stories %>%
mutate(story_id = if_else(is.na(story_id), row_number(), story_id))
stories %>%
select(-story_id)
stories %>%
mutate(story_id = row_number())
stories <- stories %>%
mutate(story_id = row_number())
View(outlets)
View(communities)
coders <- read_xlsx('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Data/Coder URL Assignment List_Summer 2017.xlsx')
View(coders)
colnames(coders) <- c("source_number", "url", "city", "coder")
coders %>%
select(-coder)
stories %>%
rename(source_number = outlet_id)
stories <- stories %>%
rename(source_number = outlet_id)
coders <- coders %>%
select(-coder)
source_list %>%
left_join(coders, by = c("url", "city"))
source_list <- source_list %>%
left_join(coders, by = c("url", "city"))
stories %>%
left_join(source_list, by = "source_number")
stories <- stories %>%
left_join(source_list, by = "source_number")
stories %>%
select(story_id, headline, outlet_id, everything())
stories <- stories %>%
select(story_id, headline, outlet_id, everything())
stories %>%
select(story_id, headline, outlet_id, original, local, cin, city)
stories <- stories %>%
select(story_id, headline, outlet_id, original, local, cin, city)
communities %>%
mutate(clean_community = str_to_lower(str_trim(city)),
clean_community = str_remove_all(clean_community, " (city|village|town|municipality|boro|borough|cdp)$"))
communities %>%
mutate(city = str_to_lower(str_trim(city)),
city = str_remove_all(clean_community, " (city|village|town|municipality|boro|borough|cdp)$"))
communities %>%
mutate(city = str_to_lower(str_trim(city)),
city = str_remove_all(city, " (city|village|town|municipality|boro|borough|cdp)$"))
communities %>%
mutate(city = str_to_lower(str_trim(city)),
city = str_remove_all(city, " (city|village|town|municipality|boro|borough|cdp)$"),
city = str_to_title(city))
communities <- communities %>%
mutate(city = str_to_lower(str_trim(city)),
city = str_remove_all(city, " (city|village|town|municipality|boro|borough|cdp)$"),
city = str_to_title(city))
state_lookup <- tibble::tibble(
full_name = tolower(state.name),
abbreviation = state.abb
)
View(state_lookup)
state_lookup %>%
mutate(full_name = str_to_title(full_name))
state_lookup <- state_lookup %>%
mutate(full_name = str_to_title(full_name))
communities %>%
mutate(state= state %>%
str_trim() %>%
str_remove(" - $"))
communities %>%
mutate(state= state %>%
str_trim() %>%
str_remove(" -$"))
communities <- communities %>%
mutate(state= state %>%
str_trim() %>%
str_remove(" -$"))
colnames(state_lookup) <- c("state", "abbreviation")
communities %>%
left_join(state_lookup, by = "state")
communities %>%
left_join(state_lookup, by = "state") %>%
select(community_id, city, state, abbreviation, everything())
communities <- communities %>%
left_join(state_lookup, by = "state") %>%
select(community_id, city, state, abbreviation, everything())
communities %>%
mutate(city = paste0(city, ", ", abbreviation))
communities <- communities %>%
mutate(city = paste0(city, ", ", abbreviation))
communities %>%
select(-c(state, geographic_area)) %>%
rename(state = abbreviation)
communities <- communities %>%
select(-c(state, geographic_area)) %>%
rename(state = abbreviation)
source_list %>%
left_join(communities, by = "city")
source_list %>%
left_join(communities, by = c("city", "state")) %>%
select(outlet_id, outlet_name, url, outlet_type, community_id)
source_list %>%
left_join(communities, by = c("city", "state")) %>%
select(outlet_id, outlet_name, url, outlet_type, community_id, city, state)
source_list <- source_list %>%
left_join(communities, by = c("city", "state")) %>%
select(outlet_id, outlet_name, url, outlet_type, community_id, city, state)
stories %>%
left_join(source_list, by = c("outlet_id", "state"))
stories %>%
left_join(source_list, by = c("outlet_id", "city"))
stories <- stories %>%
left_join(source_list, by = c("outlet_id", "city"))
stories %>%
select(story_id, headline, outlet_id, original, local, cin, community_id)
stories <- stories %>%
select(story_id, headline, outlet_id, original, local, cin, community_id)
outlets %>%
left_join(communities, by = c("city", "state")) %>%
select(outlet_id, outlet_name, url, outlet_type, community_id)
outlets <- outlets %>%
left_join(communities, by = c("city", "state")) %>%
select(outlet_id, outlet_name, url, outlet_type, community_id)
stories2 <- read_xlsx('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Data/NMRP Master Spreadsheet.xlsx')
View(stories2)
colnames(stories2) <- c("story_id", "coder", "community_id", "source_number", "day", "headline", "original", "local", "cin", "notes", "problems", "notes2", "notes3", "notes4", "notes5")
stories2 %>%
mutate(story_id = row_number()) %>%
select(story_id, day)
stories2 <- stories2 %>%
mutate(story_id = row_number()) %>%
select(story_id, day)
date_lookup <- read_xlsx(/Users/jessicamahone/Documents/date_lookup.xlsx)
date_lookup <- read_xlsx("/Users/jessicamahone/Documents/date_lookup.xlsx")
View(date_lookup)
stories_2 %>%
left_join(date_lookup, by = "day")
stories2 %>%
left_join(date_lookup, by = "day")
stories2 <- stories2 %>%
left_join(date_lookup, by = "day")
stories %>%
left_join(stories2, by = c("story_id", "day"))
stories %>%
left_join(stories2, by = "story_id")
stories <- stories %>%
left_join(stories2, by = "story_id")
stories %>%
select(story_id, publication_date, everything())
stories <- stories %>%
select(story_id, publication_date, everything())
dir.create("data/raw")        # Original untouched files
dir.create("data/interim")    # Cleaned subsets, lookups, mapping tables
dir.create("data/processed")  # Final relational tables
dir.create("scripts")         # Your RMarkdown and helper scripts
dir.create("outputs")         # Future visualizations, exports, reports
dir.create("data/raw")        # Original untouched files
dir.create("data/interim")    # Cleaned subsets, lookups, mapping tables
dir.create("data/processed")  # Final relational tables
dir.create("outputs")         # Future visualizations, exports, reports
dir.create("data/raw")        # Original untouched files
dir.create("data/")
setwd("data/")
dir.create("data/raw")        # Original untouched files
dir.create("data/interim")    # Cleaned subsets, lookups, mapping tables
dir.create("data/processed")  # Final relational tables
setwd("/Documents/UNC News Deserts Database/database")
getwd()
setwd("/Users/jessicamahone/Documents/UNC News Deserts Database/database/")
dir.create("data/raw")        # Original untouched files
dir.create("data/interim")    # Cleaned subsets, lookups, mapping tables
dir.create("data/processed")  # Final relational tables
write_csv(stories, "data/processed/stories_clean.csv")
write_csv(communities, "data/processed/communities_clean.csv")
write_csv(outlets, "data/processed/outlets_clean.csv")
stories_original <- read_xlsx('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Data/NMRP Master Spreadsheet.xlsx')
write_csv(stories_original, "data/raw/stories_original.csv")
outlets_original <- read_csv('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Outlet Concentration Analylsis_Qun/outlet.csv')
write_csv(outlets_original, "data/raw/outlets_original.csv")
View(source_list)
write_csv(source_list, "data/processed/source_list_clean.csv")
View(coders)
constructed_week <- read_xlsx('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Constructed Week Sample Revised.xlsx')
write_csv(constructed_week, "data/raw/constructed_week.csv")
communities_original <- read_xlsx('/Users/jessicamahone/Dropbox/NMRP 100 Communities Study/Data/Community Variables.xlsx')
write_csv(communities_original, "data/raw/communities_original.csv")
View(stories)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
load("~/Documents/UNC News Deserts Database/database/.RData")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(writexl)
# Load original datasets
communities <- read_xlsx("data/raw/communities_original.xlsx")
# Load original datasets
communities <- read_csv("data/raw/communities_original.csv")
outlets <- read_csv("data/raw/outlets_original.csv")
stories <- read_xlsx("data/raw/stories_original.xlsx")
# Load original datasets
communities <- read_csv("data/raw/communities_original.csv")
outlets <- read_csv("data/raw/outlets_original.csv")
stories <- read_csv("data/raw/stories_original.csv")
source_list <- read_xlsx("data/raw/Community_Source List.xlsx", sheet = "DeDuped")
library(readr)
outlets_clean <- read_csv("data/processed/outlets_clean.csv")
View(outlets_clean)
outlets_clean %>%
count(outlet_type)
167/663
library(readr)
stories_clean <- read_csv("data/processed/stories_clean.csv")
View(stories_clean)
stories_clean %>%
count(cin)
stories_clean %>%
left_join(outlets_clean, by = "outlet_id") %>%
count(outlet_type)
19166-2668
6720/16498
stories_clean %>%
left_join(outlets_clean, by = "outlet_id") %>%
filter(original == 1) %>%
count(outlet_type)
stories_clean %>%
left_join(outlets_clean, by = "outlet_id") %>%
filter(local == 1) %>%
count(outlet_type)
stories_clean %>%
left_join(outlets_clean, by = "outlet_id") %>%
filter(cin != 9) %>%
count(outlet_type)
stories_clean %>%
left_join(outlets_clean, by = "outlet_id") %>%
filter(original == 1 & original == 1 & cin != 9) %>%
count(outlet_type)
library(DBI)
library(rsqlite)
library(RSQLite)
library(DBI)
library(RSQLite)
View(stories_clean)
stories_clean %>%
select(-day)
library(tidyverse)
stories_clean %>%
select(-day)
stories_clean <- stories_clean %>%
select(-day)
write_csv(stories_clean, "/data/raw/stories_clean.csv")
View(outlets_clean)
View(communities)
View(communities_original)
View(communities)
detach("package:RSQLite", unload = TRUE)
detach("package:DBI", unload = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(writexl)
# Load original datasets
communities <- read_csv("data/raw/communities_original.csv")
outlets <- read_csv("data/raw/outlets_original.csv")
stories <- read_csv("data/raw/stories_original.csv")
source_list <- read_xlsx("data/raw/Community_Source List.xlsx", sheet = "DeDuped")
coders <- read_xlsx("data/raw/Coder URL Assignment List_Summer 2017.xlsx")
# Load original datasets
communities <- read_csv("data/raw/communities_original.csv")
outlets <- read_csv("data/raw/outlets_original.csv")
stories <- read_csv("data/raw/stories_original.csv")
source_list <- read_xlsx("data/raw/Community_Source List.xlsx", sheet = "DeDuped")
coders <- read_xlsx("data/raw/Coder URL Assignment List_Summer 2017.xlsx")
date_lookup <- read_xlsx("data/raw/date_lookup.xlsx")
View(constructed_week)
# Load original datasets
communities <- read_csv("data/raw/communities_original.csv")
outlets <- read_csv("data/raw/outlets_original.csv")
stories <- read_csv("data/raw/stories_original.csv")
source_list <- read_xlsx("data/raw/Community_Source List.xlsx", sheet = "DeDuped")
coders <- read_xlsx("data/raw/Coder URL Assignment List_Summer 2017.xlsx")
date_lookup <- read_xlsx("data/raw/date_lookup.xlsx")
View(communities_original)
# Change column names
colnames(communities) <- c("state", "city", "geographic_area", "id_number", "population", "area_sqm", "geo_id2", "dollar", "closest_large_media_market", "distance_from_lmm", "pct_white", "pct_black", "pct_hislat", "universities_count", "county_seat", "state_capital")
# Assign community_id and clean up structure
communities <- communities %>%
mutate(community_id = row_number()) %>%
select(community_id, everything()) %>%
mutate(across(c(county_seat, capital), ~replace_na(., 0))) %>%
select(-c(geo_id2, dollar))  # drop ambiguous column
View(communities)
# Load original datasets
communities <- read_csv("data/raw/communities_original.csv")
outlets <- read_csv("data/raw/outlets_original.csv")
stories <- read_csv("data/raw/stories_original.csv")
source_list <- read_xlsx("data/raw/Community_Source List.xlsx", sheet = "DeDuped")
coders <- read_xlsx("data/raw/Coder URL Assignment List_Summer 2017.xlsx")
date_lookup <- read_xlsx("data/raw/date_lookup.xlsx")
# Change column names
colnames(communities) <- c("state", "city", "geographic_area", "id_number", "population", "area_sqm", "density_pop_per_sqm" "geo_id2", "dollar", "closest_large_media_market", "distance_from_lmm", "pct_white", "pct_black", "pct_hislat", "universities_count", "county_seat", "state_capital")
# Change column names
colnames(communities) <- c("state", "city", "geographic_area", "id_number", "population", "area_sqm", "density_pop_per_sqm", "geo_id2", "dollar", "closest_large_media_market", "distance_from_lmm", "pct_white", "pct_black", "pct_hislat", "universities_count", "county_seat", "state_capital")
# Assign community_id and clean up structure
communities <- communities %>%
mutate(community_id = row_number()) %>%
select(community_id, everything()) %>%
mutate(across(c(county_seat, capital), ~replace_na(., 0))) %>%
select(-c(geo_id2, dollar))  # drop ambiguous column
# Change column names
colnames(communities) <- c("state", "city", "geographic_area", "id_number", "population", "area_sqm", "density_pop_per_sqm", "geo_id2", "dollar", "closest_large_media_market", "distance_from_lmm", "pct_white", "pct_black", "pct_hislat", "universities_count", "county_seat", "state_capital")
# Assign community_id and clean up structure
communities <- communities %>%
mutate(community_id = row_number()) %>%
select(community_id, everything()) %>%
mutate(across(c(county_seat, state_capital), ~replace_na(., 0))) %>%
select(-c(geo_id2, dollar))  # drop ambiguous column
# Standardize city names
communities <- communities %>%
mutate(city = city %>%
str_to_lower() %>%
str_trim() %>%
str_remove_all(" (city|village|town|municipality|boro|borough|cdp)$") %>%
str_to_title())
# Clean state names and match abbreviations
state_lookup <- tibble(
state = str_to_title(state.name),
abbreviation = state.abb
)
communities <- communities %>%
mutate(state = str_trim(state) %>% str_remove(" -$")) %>%
left_join(state_lookup, by = "state") %>%
mutate(city = paste0(city, ", ", abbreviation)) %>%
select(-c(state, geographic_area)) %>%
rename(state = abbreviation)
getwd()
write_csv(communities, "/data/processed/communities_clean.csv")
write_csv(communities, "data/processed/communities_clean.csv")
# Local communities_clean
communities_clean <- read_csv("data/processed/communities_clean.csv")
View(communities_clean)
# Change 1s and 0s to Yes and No in communities file
communities_binary <- c("county_seat", "state_capital")
communities_clean %>%
mutate(across(all_of(binary_columns), ~ ifelse(. == 1, "Yes", "No")))
# Local communities_clean
communities_clean <- read_csv("data/processed/communities_clean.csv")
View(communities_clean)
# Change 1s and 0s to Yes and No in communities file
communities_binary <- c("county_seat", "state_capital")
communities_clean %>%
mutate(across(all_of(communities_binary), ~ ifelse(. == 1, "Yes", "No")))
# Local communities_clean
communities_clean <- read_csv("data/processed/communities_clean.csv")
View(communities_clean)
# Change 1s and 0s to Yes and No in communities file
communities_binary <- c("county_seat", "state_capital")
communities_clean <- communities_clean %>%
mutate(across(all_of(communities_binary), ~ ifelse(. == 1, "Yes", "No")))
# Local communities_clean
communities_clean <- read_csv("data/processed/communities_clean.csv")
View(communities_clean)
# Change 1s and 0s to Yes and No in communities file
communities_binary <- c("county_seat", "state_capital")
communities_clean <- communities_clean %>%
mutate(across(all_of(communities_binary), ~ ifelse(. == 1, "Yes", "No")))
communities_clean %>%
select(community_id, city, state, everything()) %>%
select(-id_number)
# Local communities_clean
communities_clean <- read_csv("data/processed/communities_clean.csv")
View(communities_clean)
# Change 1s and 0s to Yes and No in communities file
communities_binary <- c("county_seat", "state_capital")
communities_clean <- communities_clean %>%
mutate(across(all_of(communities_binary), ~ ifelse(. == 1, "Yes", "No"))) %>%
mutate(city = sub(",\\s*[A-Z]{2}$", "", city))
communities_clean %>%
select(community_id, city, state, everything()) %>%
select(-id_number)
# Local communities_clean
communities_clean <- read_csv("data/processed/communities_clean.csv")
View(communities_clean)
# Change 1s and 0s to Yes and No in communities file
communities_binary <- c("county_seat", "state_capital")
communities_clean <- communities_clean %>%
mutate(across(all_of(communities_binary), ~ ifelse(. == 1, "Yes", "No"))) %>%
mutate(city = sub(",\\s*[A-Z]{2}$", "", city))
communities_clean <- communities_clean %>%
select(community_id, city, state, everything()) %>%
select(-id_number)
# Load stories_clean
stories_clean <- read_csv("data/processed/stories_clean.csv")
View(stories_clean)
# Recode 1s and 0s to Yes and No in stories file
stories_binary <- c("original", "local")
stories_clean %>%
mutate(across(all_of(stories_binary), ~ifelse(. == 1, "Yes", "No")))
library(read_xlsx)
library(readxl)
# Load stories_clean
stories_clean <- read_csv("data/processed/stories_clean.csv")
View(stories_clean)
# Recode 1s and 0s to Yes and No in stories file
stories_binary <- c("original", "local")
stories_clean <- stories_clean %>%
mutate(across(all_of(stories_binary), ~ifelse(. == 1, "Yes", "No")))
# Recode CINs to categories
cin_categories <- read_xlsx("data/raw/cin_categories.xlsx")
stories_clean %>%
left_join(cin_categories, by = "cin") %>%
select(story_id, publication_date, headline, outlet_id, original, local, cin_name, everything()) %>%
select(-cin) %>%
rename(critical_info_need = cin_name)
# Load stories_clean
stories_clean <- read_csv("data/processed/stories_clean.csv")
# Recode 1s and 0s to Yes and No in stories file
stories_binary <- c("original", "local")
stories_clean <- stories_clean %>%
mutate(across(all_of(stories_binary), ~ifelse(. == 1, "Yes", "No")))
# Recode CINs to categories
cin_categories <- read_xlsx("data/raw/cin_categories.xlsx")
stories_clean %>%
left_join(cin_categories, by = "cin") %>%
select(story_id, publication_date, headline, outlet_id, original, local, cin_name, everything()) %>%
select(-c(cin, day)) %>%
rename(critical_info_need = cin_name)
# Load stories_clean
stories_clean <- read_csv("data/processed/stories_clean.csv")
# Recode 1s and 0s to Yes and No in stories file
stories_binary <- c("original", "local")
stories_clean <- stories_clean %>%
mutate(across(all_of(stories_binary), ~ifelse(. == 1, "Yes", "No")))
# Recode CINs to categories
cin_categories <- read_xlsx("data/raw/cin_categories.xlsx")
stories_clean <- stories_clean %>%
left_join(cin_categories, by = "cin") %>%
select(story_id, publication_date, headline, outlet_id, original, local, cin_name, everything()) %>%
select(-c(cin, day)) %>%
rename(critical_info_need = cin_name)
write_csv(communities_clean, "data/processed/communities_clean.csv")
write_csv(stories_clean, "data/processed/stories_clean.csv")
